Задание выполнено в платформе IntelliJ IDEA 2024.1.4 Community Edition
Версия: Oracle OpenJDK 22.0.2
База данных: PostgreSQL 16

Описание проекта:

Пакет controller:

    ClientController.java
        Описание: Контроллер для обработки HTTP-запросов, связанных с клиентами. Он позволяет получать список всех клиентов, информацию о конкретном клиенте, добавлять и обновлять клиентов.
        Методы:
            GET /api/v0/pool/client/all: Получить список всех клиентов.
            GET /api/v0/pool/client/get: Получить информацию о клиенте по ID.
            POST /api/v0/pool/client/add: Добавить нового клиента.
            POST /api/v0/pool/client/update: Обновить данные существующего клиента.
        Связь: Работает с ClientService для выполнения операций с клиентами.

    ReservationController.java
        Описание: Контроллер для обработки HTTP-запросов, связанных с бронированием и отменой записей на посещение бассейна. Позволяет управлять временем бронирования, получать доступные слоты и отменять бронирования.
        Методы:
            GET /api/v0/pool/timetable/all: Получить все записи на конкретную дату.
            GET /api/v0/pool/timetable/available: Получить доступные слоты на определенную дату.
            POST /api/v0/pool/timetable/reserve: Зарезервировать слот.
            POST /api/v0/pool/timetable/cancel: Отменить запись.
        Связь: Работает с ReservationService для выполнения операций с бронированиями.


Пакет dto:

    AvailableSlot.java
        Описание: DTO для представления доступного слота для бронирования. Содержит информацию о времени и количестве доступных слотов.
        Поля:
            time: Время доступного слота.
            count: Количество доступных мест в этот слот.
        Связь: Используется в контроллере для возврата данных о доступных слотах.

    CancelRequest.java
        Описание: DTO для отмены бронирования. Содержит данные, необходимые для идентификации отменяемого бронирования.
        Поля:
            clientId: ID клиента, который делает отмену.
            orderId: Идентификатор бронирования, которое нужно отменить.
        Связь: Используется в контроллере для получения данных от клиента при отмене бронирования.

    ReservationRequest.java
        Описание: DTO для запроса бронирования. Содержит данные, которые клиент отправляет для бронирования времени.
        Поля:
            clientId: ID клиента, который делает бронирование.
            datetime: Дата и время, на которое делается бронирование.
        Связь: Используется в контроллере для получения данных от клиента при создании бронирования.

    ReservationSlot.java
        Описание: DTO для представления забронированного слота. Содержит информацию о времени и статусе бронирования.
        Поля:
            time: Время бронирования.
            clientName: Имя клиента, который забронировал слот.
        Связь: Используется в контроллере для возврата данных о бронированиях.


Пакет entity

    Client.java
        Описание: Сущность, представляющая клиента бассейна. Хранит информацию о клиенте, такую как имя, номер телефона и email.
        Поля:
            id: Уникальный идентификатор клиента.
            name: Имя клиента.
            phone: Номер телефона клиента.
            email: Электронная почта клиента.
        Связь: Сущность используется в таблице клиентов в базе данных и связана с таблицей reservations через внешний ключ.

    Reservation.java
        Описание: Сущность, представляющая бронирование. Хранит информацию о бронировании времени для конкретного клиента.
        Поля:
            id: Уникальный идентификатор бронирования.
            client: Ссылка на клиента, который сделал бронирование.
            reservationTime: Время бронирования.
        Связь: Сущность используется для хранения информации о бронированиях в базе данных. Связана с сущностью Client через внешний ключ.



Пакет exception

    ResourceNotFoundException.java
        Описание: Кастомное исключение, которое выбрасывается, когда запрашиваемый ресурс не найден в базе данных (например, клиент или бронирование).
        Связь: Используется в сервисах для обработки ошибок при отсутствии данных.



Пакет repository

    ClientRepository.java
        Описание: Репозиторий для работы с сущностью Client. Расширяет JpaRepository, предоставляя стандартные методы для работы с клиентами, такие как findAll, findById, save.
        Связь: Используется в сервисах для выполнения CRUD-операций с клиентами.

    ReservationRepository.java
        Описание: Репозиторий для работы с сущностью Reservation. Расширяет JpaRepository, предоставляя методы для работы с бронированиями, такие как findByReservationTimeBetween, countByReservationTime, findByIdAndClientId.
        Связь: Используется в сервисах для выполнения CRUD-операций с бронированиями.



Пакет service

    ClientService.java
        Описание: Сервис для обработки логики работы с клиентами. Включает методы для получения, добавления и обновления клиентов.
        Методы:
            getAllClients: Получить всех клиентов.
            getClientById: Получить клиента по ID.
            addClient: Добавить нового клиента.
            updateClient: Обновить данные клиента.
        Связь: Работает с репозиторием ClientRepository для взаимодействия с базой данных.

    ReservationService.java
        Описание: Сервис для обработки логики работы с бронированиями. Включает методы для создания, отмены бронирования и получения доступных слотов.
        Методы:
            getReservationsForDate: Получить все бронирования на определенную дату.
            reserveSlot: Зарезервировать слот для клиента.
            cancelReservation: Отменить бронирование.
        Связь: Работает с репозиториями ReservationRepository и ClientRepository.


Основной файл

    PoolApplication.java
        Описание: Главный класс приложения, который запускает Spring Boot приложение. Аннотирован как @SpringBootApplication, что включает компоненты Spring и инициализирует контекст приложения.
        Связь: Этот класс является точкой входа в приложение и запускает всю инфраструктуру Spring Boot.




Описание структуры БД (pool_query.sql)


Таблица clients

Назначение: Эта таблица хранит информацию о клиентах бассейна.

    Поля:
        id: Уникальный идентификатор клиента (тип SERIAL, автоматически увеличиваемый). Это поле является первичным ключом (PRIMARY KEY).
        name: Имя клиента (тип VARCHAR(100)), обязательное поле. Это поле не может быть пустым.
        phone: Номер телефона клиента (тип VARCHAR(20)), может быть пустым (опциональное поле).
        email: Электронная почта клиента (тип VARCHAR(100)), может быть пустым (опциональное поле).

Связи:

    В таблице reservations есть поле client_id, которое ссылается на id этой таблицы (внешний ключ).

Таблица reservations

Назначение: Эта таблица хранит данные о бронированиях клиентов. Каждое бронирование связано с конкретным клиентом и временем.

    Поля:
        id: Уникальный идентификатор записи бронирования (тип SERIAL, автоматически увеличиваемый). Это поле является первичным ключом (PRIMARY KEY).
        client_id: Внешний ключ, который ссылается на таблицу clients. Это поле указывает, какой клиент сделал данное бронирование (тип INT, обязательное поле).
        reservation_time: Время бронирования (тип TIMESTAMP), обязательное поле. Время, на которое клиент забронировал слот.
        created_at: Время создания записи бронирования (тип TIMESTAMP). По умолчанию устанавливается текущая дата и время (CURRENT_TIMESTAMP).
        Ограничение: UNIQUE(client_id, reservation_time) — комбинация клиента и времени бронирования должна быть уникальной. Это ограничение предотвращает возможность сделать несколько бронирований для одного клиента на одно и то же время.

Связи:

    Внешний ключ client_id ссылается на таблицу clients.
    С помощью поля reservation_time можно фильтровать и искать бронирования по времени.


Таблица timetable_limits

Назначение: Эта таблица хранит лимит на количество бронирований, которые могут быть сделаны на каждый час для каждого дня.

    Поля:
        date: Дата, для которой установлен лимит на бронирования (тип DATE), является первичным ключом (PRIMARY KEY).
        max_reservations_per_hour: Максимальное количество бронирований, которое может быть сделано за один час (тип INT, обязательное поле). По умолчанию установлено значение 10, что означает, что на каждый час дня может быть максимум 10 бронирований.

Связи:

    Эта таблица не имеет прямых внешних ключей, но используется для проверки и установки лимитов на количество бронирований в сервисах при регистрации бронирования.